<Page
	x:Class="Booru_Viewer.MainPage"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:local="using:Booru_Viewer"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:vm1="using:Booru_Viewer.ViewModels"
	xmlns:controls="using:Microsoft.Toolkit.Uwp.UI.Controls"
	xmlns:mvvml="using:GalaSoft.MvvmLight"
	mc:Ignorable="d"
	RequestedTheme="Default"
	Name="Page">
	
	<Page.DataContext>
		<vm1:MainPageViewModel></vm1:MainPageViewModel>
	</Page.DataContext>
	
	<Page.Resources>
		<ResourceDictionary>
			<DataTemplate x:Name="ImageTemplate">
				<controls:ImageEx Name="Image"
								  Source="{Binding Path=PreviewURL}"
								  MaxWidth="{Binding ElementName=ImageHeightSlider, Path=Value}"
								  MaxHeight="{Binding ElementName=ImageHeightSlider, Path=Value}">

					<controls:ImageEx.ContextFlyout>
						<MenuFlyout>
							<MenuFlyoutItem Text="Save Image"
											Command="{Binding SaveImage}"/>
							<MenuFlyoutItem Text="Select"
											Command="{Binding EnableMultiSelect}"/>
						</MenuFlyout>
					</controls:ImageEx.ContextFlyout>
				</controls:ImageEx>
			</DataTemplate>
			<DataTemplate x:Name="Tag">
				<StackPanel Orientation="Horizontal"
							Background="{ThemeResource SystemAccentColor}"
							BorderThickness="1" Margin="0,0,0,-5"
							>
					<StackPanel.BorderBrush>
						<SolidColorBrush Color="{ThemeResource SystemBaseLowColor}"/>
					</StackPanel.BorderBrush>
					<TextBlock Name="Tag"
							   Text="{Binding Path=Tag, Mode=TwoWay}" 
							   MinWidth="20" 
							   Margin="10,0" 
							   HorizontalAlignment="Center" 
							   VerticalAlignment="Center"
							   />
					<Button Command="{Binding Path=RemoveTag, Mode=TwoWay}"
							Background="#FF7C7C7C">
						<SymbolIcon Symbol="Cancel"/>
					</Button>
				</StackPanel>
			</DataTemplate>
			<DataTemplate x:Key="SavedSearch">
				<StackPanel Orientation="Horizontal"
							BorderThickness="1" Margin="0,0,0,-5"
							Background="{ThemeResource SystemAccentColor}">
					<StackPanel.BorderBrush>
						<SolidColorBrush Color="{ThemeResource SystemBaseLowColor}"/>
					</StackPanel.BorderBrush>
					<Button Foreground="White" 
						    MinWidth="20" 
							    
							   HorizontalAlignment="Center" 
							   VerticalAlignment="Center"
							Command="{Binding Path=StartSearch}">
						<Button.Content>
							<TextBlock Text="{Binding Path=Search}" MaxLines="2"
									   TextWrapping="WrapWholeWords"/>
						</Button.Content>
					</Button>
					<Button Command="{Binding Path=DeleteSearch}"
							Background="#FF7C7C7C">
						<Button.Content>
							<SymbolIcon Symbol="Delete"/>
						</Button.Content>
					</Button>
				</StackPanel>
			</DataTemplate>
			<DataTemplate x:Key="SuggestedTag">
				<StackPanel Orientation="Horizontal"
							BorderThickness="1" Margin="0, -4"
							Background="{ThemeResource SystemAccentColor}"
							>
					<StackPanel.BorderBrush>
						<SolidColorBrush Color="{ThemeResource SystemBaseLowColor}"/>
					</StackPanel.BorderBrush>
					<TextBlock Text="{Binding Tag}"
							   Margin="8"/>
				</StackPanel>
			</DataTemplate>
		</ResourceDictionary>
	</Page.Resources>
	<Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
		  Name="RootGrid">

		<GridView   Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
			ItemTemplate="{StaticResource ImageTemplate}"
			ItemsSource="{Binding Path=Thumbnails, Mode=TwoWay}"
			SelectionMode="{Binding ImageSelectionMode}"
			AllowFocusOnInteraction="True"
			IsEnabled="True"
			Margin="0, 25, 0, 0" 
			Name="ImageGridView"
						VerticalAlignment="Stretch"
						ScrollViewer.VerticalScrollMode="Enabled"
						ScrollViewer.ZoomMode="Disabled"
						ScrollViewer.IsVerticalRailEnabled="True"
					SelectionChanged="GridView_SelectionChanged"
					>


		</GridView>

		<!--<TextBlock Visibility="{Binding HaveImages, Mode=TwoWay}"
				   Text="{Binding NoImagesText}"/>-->
		<Button VerticalAlignment="Bottom" HorizontalAlignment="Right" Height="35" Margin="0,0,0,10" Width="117"
				Command="{Binding LoadNextPage}"
				Visibility="{Binding HaveImages}">
			<Button.Content>
				Load More
			</Button.Content>
		</Button>




	</Grid>
	<Page.BottomAppBar>
		<CommandBar VerticalAlignment="Bottom">
			<CommandBar.PrimaryCommands>

				<AppBarButton Label="Search" Icon="Find"
							  Name="SearchAppBarButton">
					<AppBarButton.Flyout>
						<Flyout x:Name="SearchFlyout">
							<StackPanel Orientation="Vertical">
								<StackPanel Margin="0, 0, 12, 0"
											MaxHeight="220"
											  MinHeight="80">
									<TextBlock Text="Saved Searches"/>
									<ListView ItemsSource="{Binding SavedSearches}"
										  ItemTemplate="{StaticResource SavedSearch}"
											  SelectionChanged="SavedSearchSelection"
											  SelectedIndex="{Binding SelectedSavedSearch, Mode=TwoWay}"
											  Name="SavedSearchesList"
											  MaxHeight="250"/>
									<TextBlock Text="You save no saved searches"
											   FontSize="12"
											   Visibility="{Binding HaveSavedSearches}"/>
								</StackPanel>
								<StackPanel Orientation="Vertical" MaxWidth="350">
									<TextBlock Text="Add tags"></TextBlock>
									<StackPanel Orientation="Horizontal">
										<TextBox PlaceholderText="Tag"
											 Name="TagTextBox"
											 MinWidth="250"
											 Text="{Binding CurrentTag, Mode=TwoWay, 
													UpdateSourceTrigger=PropertyChanged}"
											 TextChanged="TagTextBox_TextChanged"
											 AllowFocusOnInteraction="True"
											 KeyUp="TagTextBox_KeyUp"></TextBox>
										<Button Name="AddTagButton" 
											Margin="5, 0, 0, 0"
											Background="{ThemeResource SystemAccentColor}" 
											Foreground="White"
											Click="AddTagClicked"
											Command="{Binding AddTag}">
											<Button.Content>
												<SymbolIcon>Add</SymbolIcon>
											</Button.Content>
										</Button>

									</StackPanel>
									<GridView ItemsSource="{Binding SuggestedTags}"
											  ItemTemplate="{StaticResource SuggestedTag}"
											  SelectedIndex="{Binding SuggestedTagIndex, Mode=TwoWay}"/>
									<ListView ItemsSource="{Binding CurrentTags, Mode=TwoWay}"
										  ItemTemplate="{StaticResource Tag}"
										  MinHeight="20"
										  SelectionMode="None"/>
									<StackPanel Orientation="Horizontal"
											FlowDirection="RightToLeft"
												 Margin="8">
										<Button
											Content="Search Your Favourites"
											Command="{Binding SearchFavourites}"
											Visibility="{Binding IsFavButtonVisible}"
											Name="SearchFavouritesButton"
											Margin="8, 0"></Button>
										<Button Content="Save Search"
												Command="{Binding SaveSearch}"
												
												Name="SaveSearchButton"/>
									</StackPanel>
									<Button MinWidth="290" HorizontalAlignment="Center"
										Background="{ThemeResource SystemAccentColor}" 
										Foreground="White"
										Click="SearchClicked"
										Command="{Binding StartSearch}"
										Name="SearchButton">

										<Button.Content>
											<SymbolIcon>Find</SymbolIcon>
										</Button.Content>
									</Button>
								</StackPanel>
							</StackPanel>
						</Flyout>
					</AppBarButton.Flyout>
				</AppBarButton>
				<AppBarButton Label="Settings" Icon="Setting"
							  Tapped="SettingsTapped">
					<AppBarButton.Flyout>
						<Flyout>
							<Flyout.FlyoutPresenterStyle>
								<Style TargetType="FlyoutPresenter">
									<Setter Property="Height" Value="{ThemeResource FlyoutThemeMaxHeight}"></Setter>
									<Setter Property="IsTapEnabled" Value="True"></Setter>
								</Style>
							</Flyout.FlyoutPresenterStyle>
							<StackPanel Orientation="Vertical" MinWidth="300">
								<TextBlock Text="Images Per Page"/>
								
								<Slider 
									Maximum="100"
									Value="{Binding PerPage, Mode=TwoWay}"
									Minimum="10"
									StepFrequency="1"
									SnapsTo="StepValues"
									/>
								<TextBlock Text="Thumbnail Size"/>
								<Slider Minimum="200" Maximum="900"
										SnapsTo="StepValues"
										StepFrequency="15"
										Value="{Binding ImageSize, Mode=TwoWay}"
										Name="ImageHeightSlider"
										IsThumbToolTipEnabled="False"/>
								<TextBlock Text="Login Details"
										   Margin="0, 0, 0, 5"/>
								<TextBox PlaceholderText="Username"
										 Margin="0, 0, 0, 5"
										 Text="{Binding Username, Mode=TwoWay}"
										 AllowFocusOnInteraction="True"
										 Name="UsernameTextBox"/>
								<TextBox PlaceholderText="API Key"
										 Margin="0, 0, 0, 5"
										 Text="{Binding APIKey, Mode=TwoWay}"
										 AllowFocusOnInteraction="True"
										 IsEnabled="True" InputScope="Text" IsSpellCheckEnabled="False"
										 Name="APIKeyTextBox"
										 TextChanged="APIKeyTextBox_TextChanged"/>

								<Button Width="280" HorizontalAlignment="Center"
										Background="{ThemeResource SystemAccentColor}"
										Foreground="White"
										Command="{Binding SaveLoginData}"
										Tapped="SaveLoginDataButtonTapped">
									<Button.Content>
										<SymbolIcon>Save</SymbolIcon>
									</Button.Content>
								</Button>
							</StackPanel>
						</Flyout>
					</AppBarButton.Flyout>
				</AppBarButton>

			</CommandBar.PrimaryCommands>
		</CommandBar>
	</Page.BottomAppBar>
</Page>
