<Page
	x:Class="Booru_Viewer.Views.SwipeView"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:local="using:Booru_Viewer.Views"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	mc:Ignorable="d"
	xmlns:vm="using:Booru_Viewer.ViewModels"
	xmlns:controls="using:Microsoft.Toolkit.Uwp.UI.Controls"
	Name="Page">
	<Page.DataContext>
		<vm:SwipViewViewModel/>
	</Page.DataContext>

	<Page.Resources>

		<SolidColorBrush Color="{ThemeResource SystemAccentColor}"
						 x:Key="AccentColorBrush"></SolidColorBrush>
		<DataTemplate x:Name="Tag">
			<StackPanel Orientation="Horizontal"
							Background="{ThemeResource AccentColorBrush}"
							BorderThickness="1" Margin="0,0,0,-5"
							>

				<StackPanel.BorderBrush>
					<SolidColorBrush Color="{ThemeResource SystemBaseLowColor}"/>
				</StackPanel.BorderBrush>
				<TextBlock Name="Tag"
							     Text="{Binding Path=Tag, Mode=TwoWay}" 
							   MinWidth="20" 
							   Margin="10" 
							   HorizontalAlignment="Center" 
							   VerticalAlignment="Center"
							   Foreground="White"/>
				<Button
					Command="{Binding CopyTag}"
					CommandParameter="{Binding ElementName=Tag, Path=Text}"
					Background="#FF7C7C7C" VerticalAlignment="Stretch">
					<Button.Content>
						<SymbolIcon Symbol="Copy"/>
					</Button.Content>
				</Button>

			</StackPanel>
		</DataTemplate>
	</Page.Resources>
	<Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
		  Name="Grid" VerticalAlignment="Stretch"
		  HorizontalAlignment="Stretch">
		<FlipView
			ItemsSource="{Binding Images}"
			SelectedIndex="{Binding Index, Mode=TwoWay}"
			Name="FlipView"
			SelectionChanged="FlipView_OnSelectionChanged"
			Tapped="FlipView_OnTapped">
			<FlipView.ItemTemplate>
				<DataTemplate>

					
					<controls:ImageEx
							
							HorizontalAlignment="Center"
							VerticalAlignment="Center"
							Stretch="Uniform" RenderTransformOrigin="0.5,0.5">
						<controls:ImageEx.RenderTransform>
							<CompositeTransform TranslateX="0.5" TranslateY="0.5"/>
						</controls:ImageEx.RenderTransform>
						<controls:ImageEx.Source>
							<BitmapImage UriSource="{Binding FullImage}"
											 AutoPlay="True"
											 ImageOpened="BitmapImage_OnImageOpened"
											 ImageFailed="BitmapImage_OnImageFailed"
											 DownloadProgress="BitmapImage_OnDownloadProgress"
											 DecodePixelHeight="{Binding Height}"
											 >

							</BitmapImage>
						</controls:ImageEx.Source>

					</controls:ImageEx>
					



				</DataTemplate>
			</FlipView.ItemTemplate>

		</FlipView>
		<ProgressBar Name="Progress" Minimum="0" Maximum="100" VerticalAlignment="Bottom"
					 Visibility="Collapsed"></ProgressBar>
		<TextBlock Text="{Binding ElementName=FlipView, Path=SelectedIndex}"
				   VerticalAlignment="Bottom"
				   MaxHeight="20"/>
	</Grid>
	<Page.BottomAppBar>
		<CommandBar Name="AppBar">

			<AppBarButton Label="Save Image"
						  Icon="Save"
						  Command="{Binding SaveImage}">
				<ToolTip
						 IsOpen="{Binding Saving}">
					<TextBlock Text="{Binding SaveImageFailureReason}"></TextBlock>
				</ToolTip>
			</AppBarButton>
			<AppBarButton Label="View Tags"
						  Icon="List">
				<AppBarButton.Flyout>
					<Flyout>
						<ListView ItemsSource="{Binding Tags}"
								  ItemTemplate="{StaticResource Tag}"/>
					</Flyout>
				</AppBarButton.Flyout>
			</AppBarButton>
		</CommandBar>
	</Page.BottomAppBar>
</Page>



